# 概念
- Internet control massage protocol 因特网**控制**协议
- 在主机与路由器之间传递**控制信息**，包括报告错误、交换受限控制和状态信息等
- 基于 ICMP 实现的命令
	- ping 测试网络**可达性，延迟，丢包**
	- tracert 显示经过的**路径**

# ICMP的格式
![](../../photo/Pasted%20image%2020221025181043.png)
![](../../photo/Pasted%20image%2020221025181132.png)

# 应用
## ping
ping不同的返回提示语
1. 无法访问（内网中不存在这样的主机）
	- **ping内网**某主机（包括网关），找不到ip对应的mac地址
	- **不能构建icmp包**。因为没有目的mac地址
	- 经过交换机，源/目的mac地址**不会改变**
	- 经过路由器，源/目的mac地址**都会改变**，IP地址**不会变**
2. 传输失败（物理链路/网卡问题，网关未指定）
	- **ping外网**
	- **不能构建icmp包**。没有网关，也就没有目的mac地址
3. 超时
	- **发出包了，但是没有返回**
	- 对方主机不在线（有对方MAC地址缓存，对方可能关机）  
	- 对方主机屏蔽 （对方开启了策略“如防火墙”）

## tracert
- **IP 生存时间 (TTL) 字段** 和 **ICMP协议**
- 确定到目标的路由
- 过程
	- 先发送 TTL 为 1 的数据包
	- 再次发送过程将 TTL 加 1
	- 直到目标响应或 TTL 达到最大值

![](../../photo/Pasted%20image%2020221031101539.png)
