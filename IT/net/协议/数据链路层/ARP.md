# ARP
- Address Resolution Protocol，即地址解析协议
- 目的主机的IP地址 --> 目的MAC地址

## ARP协议报文
- ARP报文的总长度 64字节
	- 帧头 = 6+6+2 = 14
	- 以太帧 最小长度 46字节
		- ARP包头 = 2+2+4+6+4+6+4 = 28
		- PAD填充 = 18
	- CRC = 4
	
![](../../../photo/Pasted%20image%2020221003215650.png)

![](../../../photo/Pasted%20image%2020221003220417.png)
![ARP请求](../../../photo/Pasted%20image%2020221003215227.png)
![ARP响应](../../../photo/Pasted%20image%2020221003215324.png)

## ARP缓存表/ARP地址转换表
获取到的MAC地址会存放在该表
![](../../../photo/Pasted%20image%2020221021172614.png)

## 命令
arp -a  查看ARP缓存
arp -d  清空ARP缓存

# ARP欺骗
现象
- ARP spoofing
- **伪造网关mac地址**，导致网络不通

实现
- 攻击者**发送无效ARP响应**来伪装其他设备（一般为网关）

前提（同一广播域/同一局域网中）
1. **ARP请求为广播**形式发送的
2. **任意主机**都可以**发送ARP应答**消息
3. 主机收到应答时**不会检测该报文的真实性**就将其记录在本地的**arp缓存表**
4. 以太网协议中规定，主机间通信，**必须要知道目标主机的MAC地址**

# IP冲突检测
检测原理
- 相同IP地址的机器**回复的MAC地址不同**

检测工具
- arping
- arp-scan

后果
- 导致其中一台甚至是两台设备都被禁用或失去连接  
  
产生原因
- 分配相同的静态IP地址
- 静态IP地址在DHCP范围内，导致静态ip地址和DHCP服务器自动分配的相同
- A机器很长时间不用，IP地址分配给B机器，现在启用A机器
