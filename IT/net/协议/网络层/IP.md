# IP报文
![](../../../photo/Pasted%20image%2020221031152107.png)
-   版本version：标明IP报文的版本（ v4 或 v6）
-   头部长度header length：头部长度（最小为20B，最大为60B）
-   总长度total length：头部长度和数据长度

## 分片
当数据包的大小**超过数据链路层的MTU**就需要分成多份数据包传输
![](../../../photo/Pasted%20image%2020221031142425.png)
![](../../../photo/Pasted%20image%2020221031152941.png)
![](../../../photo/Pasted%20image%2020221031153414.png)
- 标志：用来标识同一个数据包
- 标识符Flags，3bit
	- 保留 ：未使用
	- 分段DF：1表示不能分片 （遇到超过MTU的直接丢弃）
	- 更多分段MF：1表示还有分片（0表示这是最后一个分片）
- 片偏移12bit：说明该数据包在重组后的位置

### 分片攻击
#### 方法
- 黑客构造分片报文，但是不发送最后一个分片报文

#### 原理
- DOS的攻击
- 由于最后一个分片报文永远不会达到，**接收方的内存得不到及时的释放**
	- 接收方会启动一个分片重组的定时器
	- 在一定时间内如果无法完成重组，将向发送方发送ICMP重组超时差错报文
	- 只要这种攻击的分片报文发送的足够多、足够快，很容易占满接收方内存

### 安全隐患
- 只有第一个分片报文具有四层信息而其他分片没有
- 给路由器、防火墙等中间设备在做访问控制策略匹配的时候带来了麻烦
- 两种方式
	- 【绕过检测】中间设备不对分片报文进行安全策略的匹配，直接放行IP分片报文
	- 【资源消耗】中间设备对这些分片报文进行重组后，再匹配其安全策略

## TTL
-   time to live 生存时间 （生命值）
-   防止数据包在网络中无休止的传递（防环）
-   每经过一次路由（路由转发）TTL值就会减1
-   当TTL值=0，丢弃数据包，并告诉源地址
![](../../../photo/Pasted%20image%2020221031143128.png)
![](../../../photo/Pasted%20image%2020221031143132.png)
## Protocol 协议
用来标识上层使用的协议
- 1    ICMP	因特网控制报文协议
- 2    IGMP	因特网组报文协议
- 6    TCP	       传输控制协议
- 17   UDP	用户数据报协议
- 41   IPV6	因特网v6
- 47   GRE	       通用路由封装协议
- 89   OSPF	开放式最短路径优先
- 103  PIM	协议无关报文
- 112  VRRP	虚拟路由冗余协议

# IP地址
[有道云笔记 (youdao.com)](https://note.youdao.com/web/#/file/6B57F16324ED4698BCA4AEFDCBD0F168/note/43FE36C5816D47F492BE4009F31F34F8/)
-   以点分十进制表示，有32位二进制构成
-   分为两大部分：网络位和主机位。由子网掩码决定 “分界点”
	-   网络位，代表IP地址所属的网段
	-   主机位，代表网点上的某个节点
- - 特殊用途的地址
	- 0.0.0.0 **任意地址**， 用于配置默认路由
	- 255.255.255.255 **广播地址**， 用于本网络所有节点  -
	- 127.0.0.0 **环回地址**， 用于测试本地的TCP/IP协议栈是否正常
	- 169.254.0.0 **微软分配的地址**， 用于在DHCP地址获取失败后使用的地址

## IP地址分类
![](../../../photo/Pasted%20image%2020221101084925.png)
- 能够被主机使用的地址：**A,B,C “单播地址”**
- 只能用作目的的地址：**D “组播地址”**


私网地址

范围

10.0.0.0/8

10.0.0.0~10.255.255.255

172.16.0.0/16

172.16.255.255~172.31.255.255

192.168.0.0/24

192.168.0.0~192.168.255.255
  