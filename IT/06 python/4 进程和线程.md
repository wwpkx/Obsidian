- 进程（进程控制块PCB） = 资源 + 多线程
- 线程（线程控制块TCB） = 内核调度 + 协程（用户级线程）

![](../photo/Pasted%20image%2020230612191604.png)

# 进程控制块 PCB (Process Control Block)
- **进程唯一标识符** name
- 进程当前状态 status
- 进程相应的程序和数据（**代码段和数据段**）
- 进程资源清单。除CPU外的资源，如拥有的**I/O设备，打开的文件列**表等。
- 进程**优先级** priority
- CPU现场保护区 cpustatus
- 进程同步与通信机制, 用于实现进程间互斥、同步和通信所需的信号量等。
- 进程所在队列PCB的链接字, 指出该进程所在队列中下一个进程PCB的首地址。
- 与进程有关的其他信息。 如进程记账信息，进程占用CPU的时间等。

# 线程控制模块 TCB（Thread Control Block）
- threadID：线程的唯一标识。
- status：线程的运行状态
- register：线程关于CPU中寄存器的情况
- PC程序计数器：线程执行的下一条指令的地址
- 优先级：线程在操作系统调度的时候的优先级
- 线程的专属存储区：线程单独的存储区域
- 用户栈：线程执行的用户方法栈，用来保存线程当前执行的用户方法的信息
- 内核栈：线程执行的内核方法栈，用来保存线程当前执行的内核方法信息。

# 线程和协程
| 比较点   | 线程                                    | 协程                                            |
|--------|---------------------------------------|-----------------------------------------------|
| 栈空间   | 线程拥有自己的栈空间，用户栈和内核栈    | 一般是线程提供的**用户态内存空间**                               |
| 切换操作   | 操作最终在**内核层完成**<br/>应用层需要调用内核层提供的 syscall 底层函数 | **用户层**使用代码进行简单的现场保存和恢复即可                         |
| 任务调度   | **由操作系统调度，抢占方式，依赖各种锁**    | **用户态实现，调度器进行协作**。           |
| 语音支持程度 | 绝大部分编程语言     | 部分语言：Lua，Go，Python ...                        |
| 实现规范   | 按照现代操作系统规范实现    | **无统一规范**。在应用层由开发者实现，高度自定义，比如只支持单线程的线程。不同的调度策略，等等 |