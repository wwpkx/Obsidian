- 串行外设接口（Serial Peripheral Interface）
- 高速、全双工、同步的通信总线
- 最大的缺点就是没有应答机制
- 支持**多从机**的

# 基本构成
SPI通信需要4根线，单向传输时3根线
- MISO（ Master Input Slave Output）：主设备数据输入，从设备数据输出；
- MOSI（Master Output Slave Input）：主设备数据输出，从设备数据输入；
- SCLK（Serial Clock）：时钟信号，由主设备产生；
- CS/SS（Chip Select/Slave Select）：从设备使能信号，由主设备控制，一般是低电平有效
![](../photo/Pasted%20image%2020230530151850.png)
# 通信原理
- SPI主设备和从设备都有一个串行移位寄存器
- 主设备通过向它的SPI串行寄存器写入一个字节来发起一次传输
- **MSB: 高位先行**，即在传输一个字节的时候**先传输高位**。
- **LSB: 低位先行**，即在传输一个字节的时候**先传输低位**。
![](../photo/Pasted%20image%2020230530152016.png)
  
SPI数据通信的流程：
- **主设备发起信号**，将CS/SS拉低，启动通信。
- **主设备通过发送时钟信号**，来告诉从设备进行写数据或者读数据操作
- **主机（Master）将要发送的数据写到发送数据缓存区**（Menory），缓存区经过移位寄存器，串行移位寄存器通过MOSI信号线将字节一位一位的移出去传送给从机，同时MISO接口接收到的数据经过移位寄存器一位一位的移到接收缓存区。
- 从机（Slave）也将自己的串行移位寄存器中的内容通过MISO信号线返回给主机。同时通过MOSI信号线接收主机发送的数据

# DMA
- DMA(Direct Memory Access,直接存储器访问)
- 允许**不同速度的硬件**装置来沟通
- 数据搬运的工作**全部交给DMA控制器**，而CPU不再参与任何与数据搬运相关的事情
- SPI传输如果**不使用DMA**的话一次事务的**最大传输量是64字节**
- ESP32的SDK中提供了SPI DMA操作方法，但比较复杂
- 网上有一个封装比较好的库：**ESP32 DMASPI**

# ESP32的SPI控制器
- ESP32集成了4个SPI控制器，分别是SPI0,SPI1,SPI2,SPI3
- SPI2和SPI3是通用的SPI控制器，SPI2也叫HSPL,PI3也叫VSPI
- 每个ESP32SPI主机默认最多可以接3个从机