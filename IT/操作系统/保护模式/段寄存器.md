
# 描述符表 Descriptor Table
- 全局描述符表(GDT)
- 中断描述符表(IDT)
- 局部描述符表(LDT)

## GDT、LDT、IDT的区别
GDT：全局描述符表
- Windbg使用**r gdtr和r gdtl**命令查看GDT
- 全局描述符表在系统中**只能有一个**，且可以**被每一个任务所共享**
- **任何描述符都可以放在GDT中**，但中断门和陷阱门放在GDT中不会起作用
- 能被**多个任务共享的内存**就是通过GDT完成的
- 有**2^13个描述符**（段选择子中得到），每个描述符8个字节，**最大内存64k**
- **第一个GDT为null**
- windows，gdtr的起始地址是 8003f000

LDT：局部描述符表
- 局部描述符表在系统中**可以有多个**，通产情况下是与任务数量保持对等
- 但任务可以没有局部描述表，任务间不相干的部分也是通过LDT实现的
- 这里**涉及地址映射问题和GDT一样**，中断门和陷阱门放在LDT中不会起作用

IDT：中断描述符表
- Windbg使用 **r idtr和r idtl**** 查看idt
- 中断描述符在系统中**只能有一个**
- IDT中有**256个描述符**，每个占8个字节，IDT长度可以达到2K
- 中断描述符可以是**任务门、中断门、陷阱门**
- windows，idtr的起始地址是 8003f400

# 全局描述符表寄存器（GDTR）
- **第一个GDT为null**
- 有**2^13个描述符**（段选择子中得到），每个描述符8个字节，**最大内存64k**
- 通过lgdt指令将GDT的入口地址装入此寄存器

# 段寄存器有八个
- 记住**顺序：ES、CS、SS、DS、FS、GS、LDTR、TR**。
- ES：扩展段。在**串操作**时（比如 cmovs）**目标操作数的基址是 ES**，源操作数是 DS。
- CS：代码段，配合 EIP 使用。
- SS：堆栈段，凡是**基址是 EBP 或 ESP 的**，段前缀就是 SS。
- DS：数据段，**默认的都是 DS**。
- FS、GS：80386 之后定义的。

# 段寄存器定义--宽度是 96 位
```
struct segment { 
// 段选择子，16位
 word Selector; 	//16位。可见，其他不可见
 
// 段描述符，64位（下边3个共同描述）
 word Attributes;	//16位（实际长度12位）
 dword Base;		//32位
 dword limit;		//32位（实际长度20位）。G=0,000FFFFF=1M；G=1,FFFFFFFF=4G
}
```

![](../../photo/Pasted%20image%2020221206184320.png)
## 探测 Attributes
![](../../photo/Pasted%20image%2020221206185914.png)
```
int gVar; 
__asm 
{ 
	mov AX,SS //当把 SS 修改为 CS 后，程序无法正常运行
	mov DS,AX 
	mov gVar,EAX //DS:[]=EAX
					//SS:[]=EAX，通过
					//CS:[]=EAX，不通过
} 
```
## 探测 Base
![](../../photo/Pasted%20image%2020221206194546.png)
```
int Gvar; 
__asm 
{ 
	mov AX,FS//如果将 FS 改成 DS，观察程序是否正常执行
	mov GS,AX 
	mov EAX,GS:[0] 
	mov Gvar,EAX  //Gvar==0x7FFDF000
} 
```
## 探测 limit
![](../../photo/Pasted%20image%2020221206194645.png)

